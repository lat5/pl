<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü–ª–∞–≥–∏–Ω—ã Lampa</title>
    <!-- –î–æ–±–∞–≤–ª—è–µ–º –∏–∫–æ–Ω–∫—É —Å–∞–π—Ç–∞ -->
    <link rel="icon" type="image/jpeg" href="lampa_plugins.jpg">
    <script>
        function loadPlugins() {
            var xhr = new XMLHttpRequest();
            xhr.onreadystatechange = function() {
                if (xhr.readyState === XMLHttpRequest.DONE) {
                    if (xhr.status === 200) {
                        var pluginsData = xhr.responseText;
                        parsePlugins(pluginsData);
                        checkLinks();
                    } else {
                        console.error('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ —Ñ–∞–π–ª–∞ plugins_list.txt');
                    }
                }
            };
            xhr.open('GET', 'plugins_list.txt', true);
            xhr.send();
        }

        function parsePlugins(data) {
            var plugins = data.split('\n');
            var table = document.getElementById('pluginsTable');
            var currentCategory = ''; // –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ç–µ–∫—É—â–µ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
            var isFirstCategory = true; // –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ø–µ—Ä–≤–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏

            plugins.forEach(function(plugin) {
                if (plugin.trim() !== '') {
                    // –ï—Å–ª–∏ —Å—Ç—Ä–æ–∫–∞ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å –∫–≤–∞–¥—Ä–∞—Ç–Ω–æ–π —Å–∫–æ–±–∫–∏, —Ç–æ —ç—Ç–æ –Ω–æ–≤–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è
                    if (plugin.trim().startsWith('[')) {
                        // –ï—Å–ª–∏ —ç—Ç–æ –Ω–µ –ø–µ—Ä–≤–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è, –¥–æ–±–∞–≤–ª—è–µ–º —Ç—Ä–∏ —Å—Ç—Ä–æ–∫–∏ –æ—Ç—Å—Ç—É–ø–∞
                        if (!isFirstCategory) {
                            var spacerRow = table.insertRow();
                            var spacerCell = spacerRow.insertCell(0);
                            spacerCell.colSpan = 6; // –†–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è–µ–º —è—á–µ–π–∫—É –Ω–∞ –≤—Å–µ —Å—Ç–æ–ª–±—Ü—ã
                            spacerCell.style.height = '2em'; // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—ã—Å–æ—Ç—É –æ—Ç—Å—Ç—É–ø–∞
                        } else {
                            isFirstCategory = false; // –ü–µ—Ä–≤–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è –æ–±—Ä–∞–±–æ—Ç–∞–Ω–∞
                        }

                        currentCategory = plugin.trim().slice(1, -1); // –£–±–∏—Ä–∞–µ–º —Å–∫–æ–±–∫–∏ –∏ –æ–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—É—â—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é
                        // –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç—Ä–æ–∫—É –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–∞–∑–≤–∞–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
                        var categoryRow = table.insertRow();
                        var categoryCell = categoryRow.insertCell(0);
                        categoryCell.colSpan = 6; // –†–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è–µ–º —è—á–µ–π–∫—É –Ω–∞ –≤—Å–µ —Å—Ç–æ–ª–±—Ü—ã
                        categoryCell.style.fontWeight = 'bold'; // –ñ–∏—Ä–Ω—ã–π —à—Ä–∏—Ñ—Ç –¥–ª—è –Ω–∞–∑–≤–∞–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
                        categoryCell.innerText = currentCategory;
                    } else {
                        var pluginParts = plugin.split(' - ');
                        var name = pluginParts[0];
                        var url = pluginParts[1];
                        var source = pluginParts[2] ? pluginParts[2] : '-';
                        var description = pluginParts[3] ? pluginParts.slice(3).join(' - ') : '-';
                        var row = table.insertRow();
                        var nameCell = row.insertCell(0);
                        var copyCell = row.insertCell(1);
                        var urlCell = row.insertCell(2);
                        var sourceCell = row.insertCell(3);
                        var downloadCell = row.insertCell(4);
                        var descriptionCell = row.insertCell(5);
                        nameCell.innerText = name;
                        copyCell.innerHTML = '<button onclick="copyToClipboard(\'' + url + '\')">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É</button>';
                        urlCell.innerHTML = '<a href="' + url + '" id="urlLink">' + url + '</a>';
                        sourceCell.innerHTML = source === '-' ? '-' : '<a href="' + source + '" id="sourceLink">' + source + '</a>';
                        downloadCell.innerHTML = url ? '<button onclick="downloadFile(\'' + name + '\', \'' + url + '\')" class="download-button">–°–∫–∞—á–∞—Ç—å</button>' : '-';
                        descriptionCell.innerText = description === '-' ? '-' : description;
                        
                        // –¶–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–µ—Ñ–∏—Å–∞ –≤–æ –≤—Å–µ—Ö —Å—Ç–æ–ª–±—Ü–∞—Ö
                        var cells = [nameCell, copyCell, urlCell, sourceCell, downloadCell, descriptionCell];
                        cells.forEach(function(cell) {
                            if (cell.innerText === '-') {
                                cell.style.textAlign = 'center';
                                cell.style.verticalAlign = 'middle';
                            }
                        });
                    }
                }
            });
        }

        function checkLinks() {
            var urlLink = document.getElementById('urlLink');
            var sourceLink = document.getElementById('sourceLink');

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Å—ã–ª–∫—É –∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π –∫–ª–∞—Å—Å –¥–ª—è –∫—Ä—É–∂–∫–∞
            checkLinkValidity(urlLink);
            checkLinkValidity(sourceLink);
        }

        function checkLinkValidity(linkElement) {
            if (linkElement) {
                var url = linkElement.href;
                var xhr = new XMLHttpRequest();
                xhr.onreadystatechange = function() {
                    if (xhr.readyState === XMLHttpRequest.DONE) {
                        if (xhr.status === 200) {
                            // –°—Å—ã–ª–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç, —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–µ–ª–µ–Ω—ã–π –∫—Ä—É–∂–æ–∫
                            linkElement.innerHTML = 'üü¢ ' + linkElement.innerHTML;
                        } else {
                            // –°—Å—ã–ª–∫–∞ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫—Ä–∞—Å–Ω—ã–π –∫—Ä—É–∂–æ–∫
                            linkElement.innerHTML = 'üî¥ ' + linkElement.innerHTML;
                        }
                    }
                };
                xhr.open('HEAD', url, true);
                xhr.send();
            }
        }

        function copyToClipboard(url) {
            var textField = document.createElement('textarea');
            textField.innerText = url;
            document.body.appendChild(textField);
            textField.select();
            document.execCommand('copy');
            textField.remove();
        }

        function downloadFile(name, url) {
            var xhr = new XMLHttpRequest();
            xhr.onreadystatechange = function() {
                if (xhr.readyState === XMLHttpRequest.DONE) {
                    if (xhr.status === 200) {
                        var blob = new Blob([xhr.responseText], {type: 'application/javascript'});
                        var link = document.createElement('a');
                        link.href = URL.createObjectURL(blob);
                        link.download = name + '.js';
                        document.body.appendChild(link);
                        link.click();
                        document.body.removeChild(link);
                    } else {
                        console.error('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª: ' + url);
                    }
                }
            };
            xhr.open('GET', url, true);
            xhr.send();
        }

        window.onload = loadPlugins;
    </script>
    <style>
        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 8px;
            border-bottom: 1px solid #ddd;
            vertical-align: top; /* –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ —è—á–µ–π–∫–∏ –ø–æ –≤–µ—Ä—Ö–Ω–µ–º—É –∫—Ä–∞—é */
        }

        th {
            background-color: #f2f2f2;
        }

        /* –°—Ç–∏–ª—å –∫–Ω–æ–ø–∫–∏ –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è */
        .download-button {
            width: 100%;
            height: 100%;
            text-align: center;
            vertical-align: middle;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* –í—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ —Å—Ç–æ–ª–±—Ü–∞ "–ù–∞–∑–≤–∞–Ω–∏–µ" */
        td:first-child {
            vertical-align: middle;
        }

        /* –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –æ–ø–∏—Å–∞–Ω–∏—è –ø–æ –æ–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–µ */
        td:nth-child(6) {
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
    </style>
</head>
<body>

<table id="pluginsTable">
    <tr>
        <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
        <th>–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å</th>
        <th>–°—Å—ã–ª–∫–∞</th>
        <th>–ò—Å—Ç–æ—á–Ω–∏–∫</th>
        <th>–°–∫–∞—á–∞—Ç—å</th>
        <th>–û–ø–∏—Å–∞–Ω–∏–µ</th>
    </tr>
</table>

</body>
</html>
