<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Плагины Lampa</title>
    <script>
        function loadPlugins() {
            var xhr = new XMLHttpRequest();
            xhr.onreadystatechange = function() {
                if (xhr.readyState === XMLHttpRequest.DONE) {
                    if (xhr.status === 200) {
                        var pluginsData = xhr.responseText;
                        parsePlugins(pluginsData);
                    } else {
                        console.error('Не удалось загрузить данные из файла plugins_list.txt');
                    }
                }
            };
            xhr.open('GET', 'plugins_list.txt', true);
            xhr.send();
        }

        function parsePlugins(data) {
            var plugins = data.split('\n');
            var table = document.getElementById('pluginsTable');
            plugins.forEach(function(plugin) {
                if (plugin.trim() !== '') {
                    var pluginParts = plugin.split(' - ');
                    var name = pluginParts[0];
                    var url = pluginParts[1];
                    var source = pluginParts[2] ? pluginParts[2] : '-';
                    var description = pluginParts[3] ? pluginParts[3] : '-';
                    var row = table.insertRow();
                    var nameCell = row.insertCell(0);
                    var copyCell = row.insertCell(1);
                    var sourceCell = row.insertCell(2);
                    var downloadCell = row.insertCell(3);
                    var descriptionCell = row.insertCell(4);
                    nameCell.innerText = name;
                    copyCell.innerHTML = '<button onclick="copyToClipboard(\'' + url + '\')">Копировать ссылку</button>';
                    if (source === '-') {
                        sourceCell.innerText = '-';
                    } else {
                        sourceCell.innerHTML = '<a href="' + source + '">' + source + '</a>';
                    }
                    downloadCell.innerHTML = url ? '<button style="width: 100%;" onclick="downloadFile(\'' + name + '\', \'' + url + '\')">Скачать</button>' : '-';
                    descriptionCell.innerText = description === '-' ? '-' : description;
                    if (description !== '-') {
                        descriptionCell.style.maxHeight = '2em';
                        descriptionCell.style.overflow = 'hidden';
                        descriptionCell.style.wordWrap = 'break-word';
                    }
                }
            });
        }

        function copyToClipboard(url) {
            var textField = document.createElement('textarea');
            textField.innerText = url;
            document.body.appendChild(textField);
            textField.select();
            document.execCommand('copy');
            textField.remove();
        }

        function downloadFile(name, url) {
            var xhr = new XMLHttpRequest();
            xhr.onreadystatechange = function() {
                if (xhr.readyState === XMLHttpRequest.DONE) {
                    if (xhr.status === 200) {
                        var blob = new Blob([xhr.responseText], {type: 'text/plain'});
                        var link = document.createElement('a');
                        link.href = URL.createObjectURL(blob);
                        link.download = name + '.js';
                        document.body.appendChild(link);
                        link.click();
                        document.body.removeChild(link);
                    } else {
                        console.error('Не удалось загрузить файл: ' + url);
                    }
                }
            };
            xhr.open('GET', url, true);
            xhr.send();
        }

        window.onload = loadPlugins;
    </script>
    <style>
        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 8px;
            text-align: left;
            border-bottom: 1px solid #ddd;
            vertical-align: top; /* выравнивание содержимого ячейки по верхнему краю */
        }

        th {
            background-color: #f2f2f2;
        }

        /* Центрирование ячейки со значением "-" */
        td[data-value="-"] {
            text-align: center;
            vertical-align: middle; /* центрирование по вертикали */
        }
    </style>
</head>
<body>

<table id="pluginsTable">
    <tr>
        <th>Название</th>
        <th>Скопировать</th>
        <th>Источник</th>
        <th>Скачать</th>
        <th>Описание</th>
    </tr>
</table>

</body>
</html>
